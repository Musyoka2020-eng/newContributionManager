<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organization - Contribution Manager</title>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/organization.css">
</head>
<body>
  <!-- Placeholder for organization app -->
  <div id="appContainer">
    <div class="loading show">
      <div class="spinner"></div>
      <p>Loading organization...</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js"></script>

  <!-- Services -->
  <script src="/js/services/org-manager.js"></script>
  <script src="/js/services/super-admin-service.js"></script>
  <script src="/js/adapters/organization-adapter.js"></script>

  <!-- Central Config -->
  <script src="/config-central.js"></script>
  <script src="/js/core/organization-router.js"></script>

  <!-- Organization CSS -->
  <link rel="stylesheet" href="/org-app/css/base.css">
  <link rel="stylesheet" href="/org-app/css/auth.css">
  <link rel="stylesheet" href="/org-app/css/forms.css">
  <link rel="stylesheet" href="/org-app/css/tables.css">
  <link rel="stylesheet" href="/org-app/css/modal.css">
  <link rel="stylesheet" href="/org-app/css/reports.css">
  <link rel="stylesheet" href="/org-app/css/responsive.css">

  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const { auth, database } = initializeCentralFirebase();
        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        
        // Load organization HTML structure
        await loadOrganizationStructure();
        
        // Initialize organization router
        await organizationRouter.initialize(database);
      } catch (error) {
        console.error('Initialization error:', error);
        document.querySelector('.loading').innerHTML = `
          <p style="color: red;">Failed to load organization: ${error.message}</p>
        `;
      }
    });

    /**
     * Load the HTML structure from org-app/index.html
     * This fetches the body content and injects it into the appContainer
     */
    async function loadOrganizationStructure() {
      try {
        const response = await fetch('/org-app/index.html');
        if (!response.ok) {
          throw new Error(`Failed to load organization structure: ${response.statusText}`);
        }
        
        const html = await response.text();
        
        // Parse the HTML to extract the body content
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Get the container div from org-app (should be the main content)
        const containerDiv = doc.querySelector('.container');
        if (!containerDiv) {
          throw new Error('Organization structure missing container div');
        }
        
        // Inject into appContainer
        const appContainer = document.getElementById('appContainer');
        appContainer.innerHTML = '';
        appContainer.appendChild(containerDiv.cloneNode(true));
        
        console.log('Organization structure loaded successfully');
      } catch (error) {
        console.error('Failed to load organization structure:', error);
        throw error;
      }
    }
  </script>
</body>
</html>
